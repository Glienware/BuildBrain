{
  "version": "1.0",
  "name": "Consulta Usuarios con Deuda",
  "description": "Flujo completo: Usuario → Interpretar Intención → Query DB → Formatear Respuesta → Mostrar en Dashboard",
  "nodes": {
    "node_0": {
      "type": "manual_trigger",
      "display_name": "Manual Trigger",
      "category": "INPUT",
      "position": {
        "x": 50,
        "y": 200
      },
      "settings": {
        "execution_name": "Consulta de deuda usuarios",
        "input_variables": [
          "consulta_usuario"
        ],
        "raw_json_input": "{\n  \"consulta\": \"usuarios que deben más de 300\"\n}",
        "mode": "test",
        "variables": {
          "consulta_usuario": "usuarios que deben más de 300"
        }
      }
    },
    "node_1": {
      "type": "llm",
      "display_name": "Interpretar Intención",
      "category": "AI",
      "position": {
        "x": 350,
        "y": 150
      },
      "settings": {
        "model": "claude",
        "prompt": "Eres un agente que interpreta solicitudes del usuario y genera instrucciones estructuradas para consultar una base de datos MySQL.\n\nSolicitud del usuario: {{ node_0.consulta_usuario }}\n\nAnaliza la solicitud y devuelve SOLO JSON válido con:\n- accion (select/insert/update/delete)\n- tabla\n- filtro (nombre de la columna)\n- operador (=/>/</>=/<=/LIKE)\n- valor\n\nRespuesta JSON:",
        "temperature": 0.5,
        "max_tokens": 500
      }
    },
    "node_2": {
      "type": "database",
      "display_name": "Query MySQL",
      "category": "ACTIONS",
      "position": {
        "x": 650,
        "y": 150
      },
      "settings": {
        "db_type": "mysql",
        "host": "localhost",
        "port": "3306",
        "database": "automation_test",
        "username": "root",
        "password": "LECRIS23",
        "connection_status": "connected",
        "operation": "SELECT",
        "table": "usuarios",
        "columns": "id,nombre,email,telefono,deuda,estado",
        "where_conditions": [
          {
            "field": "deuda",
            "operator": ">",
            "value": "{{ node_1.response }}"
          }
        ],
        "combine_where": "AND",
        "order_by": "deuda DESC",
        "limit": "50",
        "block_raw_sql": true,
        "sanitize_inputs": true,
        "only_select": true,
        "query_preview": "SELECT id,nombre,email,telefono,deuda,estado FROM usuarios WHERE deuda > {valor} ORDER BY deuda DESC LIMIT 50"
      }
    },
    "node_3": {
      "type": "llm",
      "display_name": "Formatear Respuesta",
      "category": "AI",
      "position": {
        "x": 950,
        "y": 150
      },
      "settings": {
        "model": "claude",
        "prompt": "Eres un asistente que explica resultados de bases de datos en lenguaje claro y amigable.\n\nDatos obtenidos de la base de datos:\n{{ node_2.rows }}\n\nGenera un JSON con:\n- mensaje: Resumen en español de los resultados\n- usuarios: Array con frases como 'Nombre debe X pesos'\n\nRespuesta JSON:",
        "temperature": 0.7,
        "max_tokens": 800
      }
    },
    "node_4": {
      "type": "dashboard_output",
      "display_name": "Dashboard Output",
      "category": "OUTPUT",
      "position": {
        "x": 1250,
        "y": 150
      },
      "settings": {
        "title": "Usuarios con Deuda > 300",
        "display_mode": "table",
        "data_source": "{{ node_2.rows }}",
        "widget_id": "deuda_usuarios_table",
        "preview_data": []
      }
    }
  },
  "connections": [
    {
      "source_node": "node_0",
      "source_port": "output",
      "target_node": "node_1",
      "target_port": "input"
    },
    {
      "source_node": "node_1",
      "source_port": "response",
      "target_node": "node_2",
      "target_port": "input"
    },
    {
      "source_node": "node_2",
      "source_port": "rows",
      "target_node": "node_3",
      "target_port": "input"
    },
    {
      "source_node": "node_3",
      "source_port": "response",
      "target_node": "node_4",
      "target_port": "data"
    }
  ],
  "variables": {
    "consulta_usuario": "usuarios que deben más de 300",
    "filtro": "deuda",
    "valor": 300
  },
  "metadata": {
    "created_at": "2025-12-14T00:00:00",
    "updated_at": "2025-12-14T00:00:00"
  }
}
